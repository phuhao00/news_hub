# NewsHub 项目开发规则

## 1. 端口和服务配置
- **严禁修改端口配置**：
  - 前端服务：3000
  - 后端服务：8081 (Go)
  - 爬虫服务：8001 (Python FastAPI)
  - MongoDB：27017
  - MinIO：9000
- **严禁修改服务名称**：frontend, backend, crawler, mongodb, minio

## 2. 技术栈约束
- 前端：Next.js 15 + React 19 + TypeScript + Tailwind CSS
- 后端：Go + Gin + MongoDB
- 爬虫服务：Python + FastAPI + Crawl4AI + MCP集成
- 数据库：MongoDB
- 存储：MinIO
- 容器化：Docker + Docker Compose

## 3. 项目结构规范
- `/src`：前端源码
- `/server`：Go后端服务
- `/crawler-service`：Python爬虫服务
- `/public`：静态资源
- 配置文件：`config.json`（全局）、`crawler-service/config.json`（爬虫专用）

## 4. 开发约束
- 使用提供的启动脚本：`start-all.ps1`
- 遵循现有的日志配置和错误处理模式
- 保持MCP服务集成的完整性
- 维护登录状态管理系统的稳定性

## 5. 代码规范
- Go代码遵循标准Go规范
- Python代码使用async/await模式
- TypeScript严格模式
- 统一使用UTF-8编码

## 6. 安全要求
- 环境变量通过`.env`文件管理
- 敏感信息不得硬编码
- API接口需要适当的错误处理
- 文件上传需要类型和大小验证

## 7. 性能要求
- 爬虫服务最大并发数：5
- 页面超时设置：30秒
- 保持现有的缓存策略

## 8. 爬取和解析规范
- **爬取策略**：
  - 使用Crawl4AI + MCP集成进行智能爬取
  - 支持平台：微博、抖音、小红书、B站
  <!-- - 遵循robots.txt和平台API限制 -->
  - 实现反爬虫检测和规避机制

- **数据解析规范**：
  - 使用CSS选择器进行精确元素定位
  - 支持动态内容等待和页面稳定性检测
  - 统一数据格式：标题、内容、作者、发布时间、标签、媒体文件
  - 实现HTML到Markdown的标准化转换

- **内容提取约束**：
  - 最小字数阈值：10字
  - 图片和视频URL完整性验证
  - 时间格式标准化（ISO 8601）
  - 去除广告和无关内容

- **错误处理机制**：
  - 网络超时重试（最多3次）
  - 页面加载失败降级处理
  - 反爬虫触发时的等待策略
  - 详细的错误日志记录

- **数据质量保证**：
  - 内容去重机制
  - 数据完整性校验
  - 敏感信息过滤
  - 存储前的数据清洗

## 9. 部署约束
- 使用Docker容器化部署
- 保持现有的依赖关系和启动顺序
- 确保所有服务的健康检查正常


